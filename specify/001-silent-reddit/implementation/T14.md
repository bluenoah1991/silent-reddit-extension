# å®ç°è®°å½• - T14

## ä»»åŠ¡ä¿¡æ¯
- **ç¼–å·**: T14
- **æè¿°**: æ·»åŠ å¼¹å‡ºå¼è®¾ç½®é¢æ¿ã€æ‰©å±•å›¾æ ‡ã€è®¾ç½®å­˜å‚¨åŠŸèƒ½å’Œå®æ—¶è®¾ç½®åˆ‡æ¢èƒ½åŠ›

## å®ç°ç»†èŠ‚

### æ¦‚è¿°
æœ¬æ¬¡å®ç°ä¸ºSilent Redditæ‰©å±•æ·»åŠ äº†å®Œæ•´çš„ç”¨æˆ·è®¾ç½®åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¼¹å‡ºå¼è®¾ç½®ç•Œé¢ã€æ‰©å±•å›¾æ ‡ã€è®¾ç½®æŒä¹…åŒ–å­˜å‚¨ï¼Œä»¥åŠå®æ—¶è®¾ç½®åˆ‡æ¢èƒ½åŠ›ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥é€šè¿‡æ‰©å±•å›¾æ ‡æ‰“å¼€è®¾ç½®é¢æ¿ï¼Œè‡ªç”±æ§åˆ¶æ˜¯å¦å¯ç”¨å†…å®¹å±è”½ã€å¹¿å‘Šå±è”½å’Œåª’ä½“å±è”½åŠŸèƒ½ã€‚

### å˜æ›´ç»Ÿè®¡
- **ä¿®æ”¹æ–‡ä»¶**: 5ä¸ªï¼ˆbuild.js, content.js, manifest.json, styles.css, .gitignoreï¼‰
- **æ–°å¢æ–‡ä»¶**: 10ä¸ªï¼ˆ7ä¸ªå›¾æ ‡æ–‡ä»¶ + popup.html + popup.js + popup.csså·²åˆå¹¶åˆ°popup.htmlï¼‰
- **ä»£ç è¡Œæ•°å˜åŒ–**:
  - build.js: 108è¡Œé‡æ„ï¼ˆæ–°å¢ç›®å½•å¤åˆ¶åŠŸèƒ½ï¼‰
  - content.js: 277è¡Œé‡æ„ï¼ˆæ–°å¢è®¾ç½®ç®¡ç†å’ŒåŠ¨æ€åˆ‡æ¢ï¼‰
  - popup.html: 82è¡Œæ–°å¢
  - popup.js: 70è¡Œæ–°å¢
  - styles.css: 61è¡Œä¼˜åŒ–ï¼ˆç®€åŒ–å¹¶ç¾åŒ–å ä½ç¬¦æ ·å¼ï¼‰
  - manifest.json: 21è¡Œæ–°å¢ï¼ˆæƒé™å’Œactioné…ç½®ï¼‰

### æ ¸å¿ƒåŠŸèƒ½å®ç°

#### 1. å¼¹å‡ºå¼è®¾ç½®é¢æ¿ (popup.html + popup.js)

**popup.htmlè®¾è®¡è¦ç‚¹**:
- ç´§å‡‘å‹ç•Œé¢è®¾è®¡ï¼ˆ280pxå®½åº¦ï¼‰ï¼Œé€‚åˆæµè§ˆå™¨æ‰©å±•å¼¹å‡ºçª—å£
- ä½¿ç”¨å†…è”æ ·å¼ï¼ˆ<style>æ ‡ç­¾ï¼‰é¿å…é¢å¤–CSSæ–‡ä»¶ï¼Œç®€åŒ–æ„å»º
- ä¸‰ä¸ªç‹¬ç«‹çš„å¼€å…³æ§ä»¶ï¼š
  - **å¯ç”¨å†…å®¹æ›¿æ¢**: ä¸»å¼€å…³ï¼Œæ§åˆ¶æ•´ä¸ªæ‰©å±•çš„å¯ç”¨/ç¦ç”¨
  - **å±è”½å¹¿å‘Š**: æ§åˆ¶æ˜¯å¦éšè—Redditå¹¿å‘Šå†…å®¹
  - **éšè—åª’ä½“**: æ§åˆ¶æ˜¯å¦éšè—å›¾ç‰‡å’Œè§†é¢‘
- ä¸­æ–‡ç•Œé¢æ–‡æœ¬ï¼Œç¬¦åˆå®ªæ³•è¯­è¨€çº¦æŸï¼ˆç”¨æˆ·äº¤äº’ä½¿ç”¨ä¸­æ–‡ï¼‰
- åº•éƒ¨æ˜¾ç¤ºå®æ—¶çŠ¶æ€å’Œç‰ˆæœ¬å·

**popup.jsæ ¸å¿ƒé€»è¾‘**:
```javascript
// é»˜è®¤è®¾ç½®
const DEFAULT_SETTINGS = {
    enabled: true,
    blockAds: true,
    blockMedia: true
};

// åŠ è½½è®¾ç½®
async function loadSettings() {
    return await chrome.storage.sync.get(DEFAULT_SETTINGS);
}

// ä¿å­˜è®¾ç½®
async function saveSettings(settings) {
    await chrome.storage.sync.set(settings);
}

// è®¾ç½®å˜æ›´æ—¶é€šçŸ¥content script
chrome.tabs.sendMessage(tabId, { 
    type: 'SETTINGS_UPDATED', 
    settings 
});
```

**ç”¨æˆ·ä½“éªŒä¼˜åŒ–**:
- å¼€å…³çŠ¶æ€å®æ—¶åé¦ˆï¼Œæ— éœ€åˆ·æ–°é¡µé¢
- å­é€‰é¡¹ï¼ˆblockAds, blockMediaï¼‰åœ¨ä¸»å¼€å…³å…³é—­æ—¶è‡ªåŠ¨ç¦ç”¨
- çŠ¶æ€æŒ‡ç¤ºå™¨åŠ¨æ€æ˜¾ç¤º"âœ“ åŠŸèƒ½å·²å¯ç”¨"æˆ–"âœ— åŠŸèƒ½å·²ç¦ç”¨"

#### 2. æ‰©å±•å›¾æ ‡ç³»ç»Ÿ

**å›¾æ ‡è§„æ ¼**:
æ·»åŠ äº†7ä¸ªä¸åŒå°ºå¯¸çš„PNGå›¾æ ‡æ–‡ä»¶ï¼Œè¦†ç›–æ‰€æœ‰Chromeæ‰©å±•ä½¿ç”¨åœºæ™¯ï¼š
- 16x16: æµè§ˆå™¨å·¥å…·æ å°å›¾æ ‡
- 24x24: å·¥å…·æ æ ‡å‡†å›¾æ ‡ï¼ˆ1.5xå¯†åº¦ï¼‰
- 32x32: å·¥å…·æ æ ‡å‡†å›¾æ ‡ï¼ˆ2xå¯†åº¦ï¼‰
- 64x64: æ‰©å±•ç®¡ç†é¡µé¢å›¾æ ‡
- 128x128: Chrome Web Storeå’Œå®‰è£…å¯¹è¯æ¡†
- 256x256: é«˜åˆ†è¾¨ç‡æ˜¾ç¤º
- 512x512: è¶…é«˜åˆ†è¾¨ç‡å’Œæ¨å¹¿ææ–™

**å›¾æ ‡è®¾è®¡**:
- æ–‡ä»¶å: `quiet@{size}.png`
- ä¸»é¢˜: "quiet"ï¼ˆå®‰é™ï¼‰ç¬¦åˆæ‰©å±•çš„æ ¸å¿ƒç†å¿µ
- æ ·å¼: ç®€æ´ã€ç°ä»£ã€æ˜“è¯†åˆ«

**manifest.jsoné…ç½®**:
```json
{
  "icons": {
    "16": "icons/quiet@16.png",
    "24": "icons/quiet@24.png",
    // ... å…¶ä»–å°ºå¯¸
  },
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "16": "icons/quiet@16.png",
      // ... å·¥å…·æ å›¾æ ‡å°ºå¯¸
    }
  }
}
```

#### 3. è®¾ç½®å­˜å‚¨ç³»ç»Ÿ

**Chrome Storage APIé›†æˆ**:
- ä½¿ç”¨`chrome.storage.sync` APIå®ç°è·¨è®¾å¤‡åŒæ­¥
- é»˜è®¤è®¾ç½®ä½œä¸ºåå¤‡å€¼ï¼Œç¡®ä¿é¦–æ¬¡åŠ è½½æ­£å¸¸
- é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œé˜²æ­¢å­˜å‚¨å¤±è´¥å½±å“åŠŸèƒ½

**manifest.jsonæƒé™**:
```json
{
  "permissions": ["storage"]
}
```

**content.jsè®¾ç½®åŠ è½½**:
```javascript
let currentSettings = { ...DEFAULT_SETTINGS };

async function loadSettings() {
    try {
        currentSettings = await chrome.storage.sync.get(DEFAULT_SETTINGS);
    } catch (error) {
        console.error('Failed to load settings:', error);
    }
}

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
async function init() {
    await loadSettings();
    if (currentSettings.enabled) applyBlockingRules();
    initObserver();
}
```

#### 4. å®æ—¶è®¾ç½®åˆ‡æ¢

**ç›‘å¬æœºåˆ¶**:
å®ç°äº†ä¸¤ç§ç›‘å¬æ–¹å¼ï¼Œç¡®ä¿è®¾ç½®å˜æ›´ç«‹å³ç”Ÿæ•ˆï¼š

**æ–¹å¼1: Messageç›‘å¬ï¼ˆpopupç›´æ¥é€šçŸ¥ï¼‰**:
```javascript
chrome.runtime.onMessage.addListener((message) => {
    if (message.type === 'SETTINGS_UPDATED') {
        currentSettings = message.settings;
        applyOrRemoveBlocking();
    }
});
```

**æ–¹å¼2: Storageç›‘å¬ï¼ˆè·¨æ ‡ç­¾é¡µåŒæ­¥ï¼‰**:
```javascript
chrome.storage.onChanged.addListener((changes, areaName) => {
    if (areaName !== 'sync') return;
    
    let updated = false;
    ['enabled', 'blockAds', 'blockMedia'].forEach(key => {
        if (changes[key]) {
            currentSettings[key] = changes[key].newValue;
            updated = true;
        }
    });
    
    if (updated) applyOrRemoveBlocking();
});
```

**åŠ¨æ€åˆ‡æ¢é€»è¾‘**:
```javascript
function applyOrRemoveBlocking() {
    if (!currentSettings.enabled) {
        removeAllBlocking();  // å®Œå…¨ç§»é™¤æ‰€æœ‰å±è”½æ•ˆæœ
        return;
    }
    
    // æ ¹æ®å­é€‰é¡¹åˆ†åˆ«å¤„ç†
    currentSettings.blockAds ? hideAds() : showAds();
    currentSettings.blockMedia ? hideMedia() : showMedia();
}
```

**åŠŸèƒ½ç»†èŠ‚**:
- `removeAllBlocking()`: æ¢å¤æ‰€æœ‰éšè—çš„å…ƒç´ ï¼Œç§»é™¤å ä½ç¬¦
- `hideAds()` / `showAds()`: ä½¿ç”¨`display: none`åˆ‡æ¢å¹¿å‘Šå¯è§æ€§
- `hideMedia()` / `showMedia()`: åˆ‡æ¢åª’ä½“å®¹å™¨å¯è§æ€§å’Œå ä½ç¬¦

#### 5. content.jsé‡æ„ä¼˜åŒ–

**ä»£ç ç»“æ„æ”¹è¿›**:
- æå–å¸¸é‡: `AD_SELECTORS`, `MEDIA_CONTAINER_SELECTOR`
- åŠŸèƒ½æ¨¡å—åŒ–: åˆ†ç¦»å¹¿å‘Šå¤„ç†ã€åª’ä½“å¤„ç†ã€è®¾ç½®ç®¡ç†
- é˜²é‡å¤å¤„ç†: ä½¿ç”¨`data-silent-reddit-*`å±æ€§æ ‡è®°

**åª’ä½“ä¿ç•™ç­–ç•¥ä¼˜åŒ–**:
æ–°å¢`shouldPreserveMedia()`å‡½æ•°ï¼Œç»Ÿä¸€åˆ¤æ–­å“ªäº›åª’ä½“å…ƒç´ åº”è¯¥ä¿ç•™ï¼š
```javascript
function shouldPreserveMedia(container) {
    // å·²å¤„ç†çš„å®¹å™¨
    if (container.dataset.silentRedditPlaceholder) return true;
    
    const img = container.querySelector('img');
    if (img) {
        // ç¤¾åŒºå›¾æ ‡
        if (img.classList.contains('shreddit-subreddit-icon__icon')) return true;
        // ç”¨æˆ·å¤´åƒ
        if (img.closest('a[href*="/user/"]')) return true;
        // ç¤¾åŒºçŠ¶æ€å›¾æ ‡
        if (img.closest('community-status-tooltip, community-status')) return true;
        // ç©ºçŠ¶æ€æ’å›¾
        if (img.closest('comment-forest-empty-state, #low-comments-banner')) return true;
        // ç¼©ç•¥å›¾ï¼ˆå¸–å­åˆ—è¡¨çš„å°å›¾ï¼‰
        if (container.closest('[slot="thumbnail"]')) return true;
        // å°å‹UIå›¾æ ‡
        const width = parseInt(window.getComputedStyle(img).width) || 0;
        const height = parseInt(window.getComputedStyle(img).height) || 0;
        if (width < 32 && height < 32) return true;
    }
    
    return false;
}
```

**å ä½ç¬¦æ”¹è¿›**:
- åŒºåˆ†å›¾ç‰‡å’Œè§†é¢‘: ä½¿ç”¨ä¸åŒçš„emojiï¼ˆğŸ–¼ï¸ vs ğŸ“¹ï¼‰
- `createPlaceholder(isVideo)`å‡½æ•°ç»Ÿä¸€åˆ›å»ºå ä½ç¬¦å…ƒç´ 
- è‡ªåŠ¨æ£€æµ‹å®¹å™¨å†…å®¹ç±»å‹ï¼ˆé€šè¿‡æŸ¥æ‰¾`shreddit-embed`ç­‰å…ƒç´ ï¼‰

**æ€§èƒ½ä¼˜åŒ–**:
- æå‰è¿”å›: åŠŸèƒ½ç¦ç”¨æ—¶ç«‹å³é€€å‡ºï¼Œé¿å…ä¸å¿…è¦çš„DOMæŸ¥è¯¢
- é€‰æ‹©å™¨ç¼“å­˜: ä½¿ç”¨å¸¸é‡å­˜å‚¨å¤æ‚é€‰æ‹©å™¨
- æ‰¹é‡å¤„ç†: ä½¿ç”¨`querySelectorAll`æ‰¹é‡æŸ¥æ‰¾å’Œå¤„ç†å…ƒç´ 

#### 6. æ„å»ºç³»ç»Ÿå¢å¼º (build.js)

**ç›®å½•å¤åˆ¶åŠŸèƒ½**:
æ–°å¢`copyDir()`å‡½æ•°ï¼Œæ”¯æŒé€’å½’å¤åˆ¶æ•´ä¸ªç›®å½•ï¼š
```javascript
function copyDir(dirName) {
    const sourcePath = path.join(SOURCE_DIR, dirName);
    const destPath = path.join(OUTPUT_DIR, dirName);
    
    ensureDir(destPath);
    const files = fs.readdirSync(sourcePath);
    
    files.forEach(file => {
        const sourceFile = path.join(sourcePath, file);
        const destFile = path.join(destPath, file);
        
        if (fs.statSync(sourceFile).isDirectory()) {
            copyDir(path.join(dirName, file));  // é€’å½’å¤„ç†å­ç›®å½•
        } else {
            fs.copyFileSync(sourceFile, destFile);
        }
    });
}
```

**é…ç½®æ›´æ–°**:
```javascript
const FILES_TO_COPY = [
    'manifest.json', 
    'content.js', 
    'styles.css', 
    'popup.html',   // æ–°å¢
    'popup.js'      // æ–°å¢
];

const DIRS_TO_COPY = ['icons'];  // æ–°å¢
```

**watchæ¨¡å¼å¢å¼º**:
æ–°å¢å¯¹`icons/`ç›®å½•çš„ç›‘å¬ï¼š
```javascript
DIRS_TO_COPY.forEach(dirName => {
    const dirPath = path.join(SOURCE_DIR, dirName);
    if (fs.existsSync(dirPath)) {
        fs.watch(dirPath, { recursive: true }, (eventType, filename) => {
            if (eventType === 'change' || eventType === 'rename') {
                console.log(`Directory changed: ${dirName}/${filename || ''}`);
                copyDir(dirName);
            }
        });
    }
});
```

**ä»£ç ç®€åŒ–**:
- ç§»é™¤å†—ä½™æ³¨é‡Š
- åˆå¹¶é‡å¤é€»è¾‘
- ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ç®€åŒ–æ¡ä»¶åˆ¤æ–­

#### 7. æ ·å¼ä¼˜åŒ– (styles.css)

**å ä½ç¬¦è§†è§‰æ”¹è¿›**:
ä»ç®€å•æ–‡æœ¬æ ·å¼å‡çº§ä¸ºç°ä»£åŒ–æ¸å˜å¡ç‰‡è®¾è®¡ï¼š

**ä¹‹å‰**:
```css
.silent-reddit-text-placeholder {
    display: inline-block;
    color: #878a8c;
    font-size: 12px;
    padding: 4px 8px;
    background-color: #f6f7f8;
    border-radius: 4px;
}
```

**ç°åœ¨**:
```css
.silent-reddit-text-placeholder {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;           /* ä½¿ç”¨emojiï¼Œå­—ä½“æ›´å¤§ */
    padding: 4px 6px;
    margin: 4px 0 8px;
    background: linear-gradient(135deg, #f0f4f8, #e6eef5);  /* æ¸å˜èƒŒæ™¯ */
    border-radius: 6px;
    border: 1px solid #d3dce6;
    box-shadow: 0 1px 2px #0000000d;
    transition: all .2s;
    cursor: default;
    opacity: .9;
}

.silent-reddit-text-placeholder:hover {
    background: linear-gradient(135deg, #e8f0f8, #dae6f0);
    border-color: #b8c9db;
    box-shadow: 0 2px 3px #00000014;
    opacity: 1;
}
```

**è®¾è®¡æ”¹è¿›**:
- ä½¿ç”¨flexboxå±…ä¸­emojiå›¾æ ‡
- æ¸å˜èƒŒæ™¯æå‡è§†è§‰å±‚æ¬¡
- hoveræ•ˆæœå¢åŠ äº¤äº’åé¦ˆ
- é˜´å½±å’Œè¿‡æ¸¡åŠ¨ç”»æå‡ç°ä»£æ„Ÿ

**ä»£ç æ¸…ç†**:
ç§»é™¤äº†å†—ä½™çš„CSSæ³¨é‡Šå’Œå¤šä½™çš„é€‰æ‹©å™¨ï¼Œä¿ç•™æ ¸å¿ƒæ ·å¼å®šä¹‰ã€‚

### æŠ€æœ¯äº®ç‚¹

1. **é›¶å¤–éƒ¨ä¾èµ–**: popup.htmlä½¿ç”¨å†…è”CSSï¼Œé¿å…é¢å¤–çš„æ ·å¼æ–‡ä»¶
2. **è·¨è®¾å¤‡åŒæ­¥**: ä½¿ç”¨`chrome.storage.sync`å®ç°è®¾ç½®äº‘åŒæ­¥
3. **åŒé‡ç›‘å¬æœºåˆ¶**: Message + Storageç›‘å¬ç¡®ä¿è®¾ç½®å˜æ›´å¯é ä¼ é€’
4. **ä¼˜é›…é™çº§**: å­˜å‚¨å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
5. **æ€§èƒ½ä¼˜åŒ–**: æå‰è¿”å›å’Œé€‰æ‹©å™¨ç¼“å­˜å‡å°‘DOMæ“ä½œå¼€é”€
6. **ä»£ç ç®€åŒ–**: é‡æ„æ¶ˆé™¤å†—ä½™ï¼Œæå‡å¯ç»´æŠ¤æ€§

### ç”¨æˆ·ä½“éªŒæå‡

1. **å³æ—¶åé¦ˆ**: è®¾ç½®å˜æ›´ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€åˆ·æ–°é¡µé¢
2. **çŠ¶æ€é€æ˜**: æ¸…æ™°æ˜¾ç¤ºå½“å‰åŠŸèƒ½å¯ç”¨çŠ¶æ€
3. **ç»†ç²’åº¦æ§åˆ¶**: åˆ†åˆ«æ§åˆ¶å¹¿å‘Šå’Œåª’ä½“å±è”½
4. **è§†è§‰ç¾åŒ–**: å ä½ç¬¦é‡‡ç”¨ç°ä»£æ¸å˜è®¾è®¡
5. **å›½é™…åŒ–å‡†å¤‡**: ä¸­æ–‡ç•Œé¢ç¬¦åˆç›®æ ‡ç”¨æˆ·ç¾¤ä½“

### éªŒè¯æµ‹è¯•

å»ºè®®è¿›è¡Œä»¥ä¸‹æµ‹è¯•ï¼š
1. æµ‹è¯•popupé¢æ¿å¼€å…³çš„å®æ—¶å“åº”
2. éªŒè¯è®¾ç½®è·¨æ ‡ç­¾é¡µåŒæ­¥æ•ˆæœ
3. æµ‹è¯•åŠŸèƒ½å®Œå…¨ç¦ç”¨åçš„æ¢å¤æ•ˆæœ
4. æ£€æŸ¥å„å°ºå¯¸å›¾æ ‡åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ˜¾ç¤º
5. éªŒè¯å ä½ç¬¦åœ¨ä¸åŒä¸»é¢˜ä¸‹çš„å¯è¯»æ€§

---
*åˆ›å»ºæ—¶é—´: 2025-10-17*
