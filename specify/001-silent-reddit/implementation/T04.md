# 实现记录 - T04

## 任务信息
- **编号**: T04
- **描述**: 创建styles.css文件，实现广告和图片的CSS屏蔽规则，使用语言无关的选择器策略（shreddit-ad-post、slot属性等）

## 实现细节

### 创建styles.css文件
基于D01和D02讨论结论，创建了完全语言无关的CSS屏蔽规则。

**文件内容：**
```css
/* Silent Reddit - CSS blocking rules for ads and images */

/* ===== Ad Blocking ===== */
/* Block promoted posts using language-agnostic custom element tag */
shreddit-ad-post {
    display: none !important;
}

/* ===== Image Blocking ===== */
/* Block post images and thumbnails using slot attributes (most precise) */
article img[slot="thumbnail"],
article img[slot="image-gallery"] {
    display: none !important;
}

/* Fallback: Block all images in articles, except subreddit icons */
article img:not(.shreddit-subreddit-icon__icon) {
    display: none !important;
}

/* ===== Preserved Elements ===== */
/* Ensure user avatars remain visible (in case fallback rule applies) */
a[href*="/user/"] img {
    display: block !important;
}

/* Ensure subreddit icons remain visible (in case fallback rule applies) */
.shreddit-subreddit-icon__icon {
    display: block !important;
}

/* ===== Additional Blocking ===== */
/* Block video posts and media players if they contain images */
article video,
article shreddit-player {
    display: none !important;
}

/* Block image containers to prevent layout issues */
article [slot="post-media-container"] {
    display: none !important;
}
```

### CSS规则说明

**1. 广告屏蔽 (Ad Blocking):**
- `shreddit-ad-post` - Reddit的自定义元素标签，完全语言无关
- 使用 `display: none !important` 完全隐藏元素

**2. 图片屏蔽 (Image Blocking):**
- **主规则**: `article img[slot="thumbnail"]` 和 `article img[slot="image-gallery"]`
  - 使用slot属性选择器，最精确的匹配方式
  - 符合D02讨论中发现的Reddit DOM结构特征
  
- **后备规则**: `article img:not(.shreddit-subreddit-icon__icon)`
  - 屏蔽所有文章中的图片，但排除社区图标
  - 作为slot属性不存在时的降级方案

**3. 保留元素 (Preserved Elements):**
- **用户头像**: `a[href*="/user/"] img`
  - 通过父元素链接特征识别（包含"/user/"的链接内的图片）
  - 符合D02讨论结论
  
- **社区图标**: `.shreddit-subreddit-icon__icon`
  - 使用CSS类名选择器
  - 确保在后备规则下仍然可见

**4. 额外屏蔽 (Additional Blocking):**
- **视频和媒体播放器**: `article video`, `article shreddit-player`
  - 屏蔽视频内容，避免包含缩略图的媒体元素
  
- **媒体容器**: `article [slot="post-media-container"]`
  - 屏蔽整个媒体容器，防止布局问题

### 设计特点

**语言无关策略 (符合D02讨论):**
- ✅ 完全基于DOM结构特征（元素标签、属性、类名）
- ✅ 不依赖任何文本内容（"已推广"、"Promoted"等）
- ✅ 支持Reddit的多语言界面（英语、中文、法语等）

**CSS优先级:**
- 使用 `!important` 确保规则优先级最高
- 避免被Reddit的样式覆盖

**可维护性:**
- 清晰的注释说明每个规则的作用
- 分组组织（广告、图片、保留、额外）
- 易于后续调整和扩展

### 符合宪法约束
- ✅ 所有注释使用英文
- ✅ 符合D01和D02讨论决策
- ✅ 符合语言无关设计原则

---
*创建时间: 2025-10-17*
