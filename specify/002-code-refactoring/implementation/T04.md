# 实现记录 - T04

## 任务信息
- **编号**: T04
- **描述**: 创建 logo-replacer.js 模块：实现 replaceAll 和 restoreAll 方法处理 Stack Overflow Logo 替换

## 实现细节

### 模块设计
创建了 `SilentReddit.logoReplacer` 对象，提供 Logo 替换和恢复功能。

### 核心方法

#### 1. replaceAll() 方法
替换 Reddit Logo 为 Stack Overflow Logo：
```javascript
replaceAll() {
    const logoLink = document.querySelector(SilentReddit.SELECTORS.REDDIT_LOGO);
    if (!logoLink || logoLink.hasAttribute(SilentReddit.DATA_ATTRS.LOGO_REPLACED)) {
        return;
    }

    // Save original content
    logoLink.setAttribute(SilentReddit.DATA_ATTRS.LOGO_REPLACED, 'true');
    logoLink.setAttribute(SilentReddit.DATA_ATTRS.ORIGINAL_CONTENT, logoLink.innerHTML);
    
    // Clear and style the link
    logoLink.innerHTML = '';
    logoLink.style.cssText = '...';

    // Create and append Stack Overflow logo
    const soLogo = document.createElement('img');
    soLogo.src = chrome.runtime.getURL('stack-overflow-wordmark.svg');
    soLogo.alt = 'Stack Overflow';
    soLogo.style.cssText = '...';

    logoLink.appendChild(soLogo);
}
```

**关键特性：**
- 幂等性：通过 `LOGO_REPLACED` 属性标记避免重复处理
- 保存原始内容到 `ORIGINAL_CONTENT` 属性
- 使用 `chrome.runtime.getURL()` 获取扩展资源路径
- 设置完整的样式确保 Logo 正确显示

#### 2. restoreAll() 方法
恢复原始 Reddit Logo：
```javascript
restoreAll() {
    const logoLink = document.querySelector(SilentReddit.SELECTORS.REDDIT_LOGO);
    if (!logoLink || !logoLink.hasAttribute(SilentReddit.DATA_ATTRS.LOGO_REPLACED)) {
        return;
    }

    // Restore original content
    const originalContent = logoLink.getAttribute(SilentReddit.DATA_ATTRS.ORIGINAL_CONTENT) || '';
    logoLink.innerHTML = originalContent;
    logoLink.style.cssText = '';
    
    // Remove data attributes
    logoLink.removeAttribute(SilentReddit.DATA_ATTRS.LOGO_REPLACED);
    logoLink.removeAttribute(SilentReddit.DATA_ATTRS.ORIGINAL_CONTENT);
}
```

**关键特性：**
- 恢复原始 HTML 内容
- 清除所有自定义样式
- 删除数据属性标记

### 设计原则
- ✅ 职责单一：只处理 Logo 替换
- ✅ 幂等性：多次调用不会产生副作用
- ✅ 可逆性：replaceAll 和 restoreAll 配对使用
- ✅ 使用统一的命名空间和数据属性（符合 D02 和 D03 讨论）

### 日志
模块加载时输出：`[SR] Logo replacer module loaded`

---
*创建时间: 2025-10-18*
