# 实现记录 - T07

## 任务信息
- **编号**: T07
- **描述**: 创建 media-blocker.js 模块：实现 hideAll 和 showAll 方法处理媒体内容、缩略图和社区状态图标

## 实现细节

### 模块设计
创建了 `SilentReddit.mediaBlocker` 对象，处理所有媒体相关内容的隐藏和显示。

### 核心方法

#### 1. _createPlaceholder(isVideo) 私有方法
创建媒体占位符：
```javascript
_createPlaceholder(isVideo) {
    const placeholder = document.createElement('span');
    placeholder.className = SilentReddit.CSS_CLASSES.TEXT_PLACEHOLDER;
    placeholder.innerHTML = isVideo ? '🎬' : '🖼️';
    placeholder.title = `${isVideo ? 'Video' : 'Image'} hidden`;
    return placeholder;
}
```

**特点：**
- 使用 emoji 图标区分图片和视频
- 添加 title 属性提供提示信息

#### 2. hideAll(targetNode = document) 方法
隐藏所有媒体内容：

**处理媒体容器：**
```javascript
targetNode.querySelectorAll(SilentReddit.SELECTORS.MEDIA_CONTAINER).forEach(container => {
    if (container.hasAttribute(SilentReddit.DATA_ATTRS.MEDIA_PLACEHOLDER)) {
        return;
    }

    const hasVideo = container.querySelector('shreddit-embed, shreddit-async-loader[bundlename="embed"]');
    const hasImage = container.querySelector('img');

    if (hasImage || hasVideo) {
        container.setAttribute(SilentReddit.DATA_ATTRS.MEDIA_PLACEHOLDER, 'true');
        container.style.setProperty('display', 'none', 'important');
        container.parentNode?.insertBefore(this._createPlaceholder(!!hasVideo), container.nextSibling);
    }
});
```

**处理缩略图：**
```javascript
targetNode.querySelectorAll(SilentReddit.SELECTORS.THUMBNAIL).forEach(thumbnail => {
    if (!thumbnail.hasAttribute(SilentReddit.DATA_ATTRS.MEDIA_HIDDEN)) {
        thumbnail.setAttribute(SilentReddit.DATA_ATTRS.MEDIA_HIDDEN, 'true');
        thumbnail.style.setProperty('display', 'none', 'important');
    }
});
```

**处理社区状态图标：**
```javascript
targetNode.querySelectorAll(SilentReddit.SELECTORS.COMMUNITY_STATUS).forEach(status => {
    if (!status.hasAttribute(SilentReddit.DATA_ATTRS.MEDIA_HIDDEN)) {
        status.setAttribute(SilentReddit.DATA_ATTRS.MEDIA_HIDDEN, 'true');
        status.style.setProperty('display', 'none', 'important');
    }
});
```

#### 3. showAll() 方法
显示所有隐藏的媒体内容：

**恢复媒体容器：**
```javascript
document.querySelectorAll(SilentReddit.SELECTORS.MEDIA_WITH_PLACEHOLDER).forEach(container => {
    container.style.display = '';
    container.removeAttribute(SilentReddit.DATA_ATTRS.MEDIA_PLACEHOLDER);
});

// Remove all placeholder elements
document.querySelectorAll(`.${SilentReddit.CSS_CLASSES.TEXT_PLACEHOLDER}`).forEach(el => el.remove());
```

**恢复缩略图和状态图标：**
```javascript
document.querySelectorAll(SilentReddit.SELECTORS.THUMBNAIL_HIDDEN).forEach(thumbnail => {
    thumbnail.style.removeProperty('display');
    thumbnail.removeAttribute(SilentReddit.DATA_ATTRS.MEDIA_HIDDEN);
});

document.querySelectorAll(SilentReddit.SELECTORS.COMMUNITY_STATUS_HIDDEN).forEach(status => {
    status.style.removeProperty('display');
    status.removeAttribute(SilentReddit.DATA_ATTRS.MEDIA_HIDDEN);
});
```

### 处理的媒体类型
1. **媒体容器** - 帖子中的图片和视频（替换为占位符）
2. **缩略图** - 列表视图中的缩略图（直接隐藏）
3. **社区状态图标** - 社区徽章图标（直接隐藏）

### 设计特点
- ✅ 幂等性：使用数据属性标记避免重复处理
- ✅ 完整恢复：清理所有占位符和数据属性
- ✅ 智能检测：区分图片和视频，显示不同占位符
- ✅ 支持动态内容：通过 targetNode 参数处理新节点

### 日志
模块加载时输出：`[SR] Media blocker module loaded`

---
*创建时间: 2025-10-18*
