# 实现记录 - T11

## 任务信息
- **编号**: T11
- **描述**: 扩展constants.js中的THUMBNAIL和THUMBNAIL_HIDDEN选择器，添加`[data-testid="search_post_thumbnail"]`以支持搜索结果页面的帖子缩略图隐藏

## 实现细节

### 问题分析

在搜索结果页面，帖子列表中右侧的缩略图未被隐藏。通过分析HTML结构发现：

```html
<search-telemetry-tracker data-testid="search-sdui-post">
  <div class="flex justify-between items-center">
    <div class="w-full flex flex-col">
      <!-- 帖子标题和信息 -->
    </div>
    <search-telemetry-tracker>
      <a href="/r/amazonprime/comments/...">
        <div class="inline rounded-1 overflow-hidden">
          <faceplate-img data-testid="search_post_thumbnail" 
                         class="rounded-1 object-cover h-[60px] w-[80px]"
                         src="https://b.thumbs.redditmedia.com/...">
          </faceplate-img>
        </div>
      </a>
    </search-telemetry-tracker>
  </div>
</search-telemetry-tracker>
```

**问题原因**：
- 搜索结果页面的帖子缩略图使用 `data-testid="search_post_thumbnail"` 属性
- 而原有的 `THUMBNAIL` 选择器只包含 `[data-testid="post-thumbnail"]`（没有 `search_` 前缀）
- 导致 `media-blocker.js` 的 `hideAll()` 方法无法识别和隐藏这些缩略图

### 修改内容

**文件**: `constants.js`

**修改1 - 扩展THUMBNAIL选择器**：

```javascript
// Before:
THUMBNAIL: '[slot="thumbnail"], [data-testid="post-thumbnail"]',

// After:
THUMBNAIL: '[slot="thumbnail"], [data-testid="post-thumbnail"], [data-testid="search_post_thumbnail"]',
```

**修改2 - 扩展THUMBNAIL_HIDDEN选择器**：

```javascript
// Before:
THUMBNAIL_HIDDEN: '[slot="thumbnail"][data-sr-media-hidden], [data-testid="post-thumbnail"][data-sr-media-hidden]',

// After:
THUMBNAIL_HIDDEN: '[slot="thumbnail"][data-sr-media-hidden], [data-testid="post-thumbnail"][data-sr-media-hidden], [data-testid="search_post_thumbnail"][data-sr-media-hidden]',
```

### 技术实现说明

1. **选择器扩展**：
   - 在 `THUMBNAIL` 选择器中添加 `[data-testid="search_post_thumbnail"]`
   - 确保 `media-blocker.js` 的 `hideAll()` 方法能够识别搜索页面的缩略图

2. **恢复选择器同步**：
   - 在 `THUMBNAIL_HIDDEN` 选择器中同步添加 `[data-testid="search_post_thumbnail"][data-sr-media-hidden]`
   - 确保 `media-blocker.js` 的 `showAll()` 方法能够正确恢复这些缩略图的显示状态

3. **工作原理**：
   - 当 `media-blocker.js` 执行时，会使用 `THUMBNAIL` 选择器查询所有缩略图元素
   - 对匹配到的元素添加 `data-sr-media-hidden="true"` 标记并设置 `display: none`
   - 当恢复时，使用 `THUMBNAIL_HIDDEN` 选择器查询所有已隐藏的缩略图，移除标记和样式

### 验证结果

- ✅ 选择器能正确匹配搜索结果页面的帖子缩略图
- ✅ 构建成功，无错误
- ✅ 不会误匹配其他元素（`search_post_thumbnail` 是搜索页面缩略图的专用标识）

### 影响范围

- **修改文件**: `constants.js`
- **影响模块**: `media-blocker.js`
- **影响功能**: 搜索结果页面帖子缩略图的隐藏和恢复

---
*创建时间: 2025-10-19*
