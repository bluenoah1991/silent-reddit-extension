````markdown
# 实现记录 - T19

## 任务信息
- **编号**: T19
- **描述**: 在icons-replacer.js中新增_replaceModeratorListAvatars方法，专门处理版主列表头像替换（支持普通头像、Snoovatar和默认头像）

## 实现细节

### 修改文件
- `icons-replacer.js`

### 变更内容

**新增方法**：
```javascript
// Replace moderator list avatars
_replaceModeratorListAvatars(targetNode) {
    targetNode.querySelectorAll(SilentReddit.SELECTORS.MODERATOR_LIST_ITEM).forEach(tracker => {
        // Find the list item containing this tracker
        const listItem = tracker.closest('li');
        if (!listItem) return;

        // Find all avatars in this list item
        const avatars = listItem.querySelectorAll('img, .snoovatar');
        avatars.forEach(avatar => {
            // Skip if already replaced
            if (avatar.hasAttribute(SilentReddit.DATA_ATTRS.ICON_REPLACED)) return;

            // Extract username from the tracker's link
            const link = tracker.querySelector('a[href*="/user/"]');
            if (!link) return;

            const match = link.href.match(/\/user\/([^/?]+)/);
            if (!match) return;

            const username = match[1];
            const letterAvatar = this._createLetterAvatar(username);
            if (!letterAvatar) return;

            // Handle img elements
            if (avatar.tagName === 'IMG') {
                avatar.setAttribute(SilentReddit.DATA_ATTRS.ICON_REPLACED, 'true');
                avatar.setAttribute(SilentReddit.DATA_ATTRS.ORIGINAL_SRC, avatar.src);
                avatar.setAttribute(SilentReddit.DATA_ATTRS.ORIGINAL_STYLE, avatar.style.cssText);
                avatar.style.setProperty('display', 'none', 'important');
                avatar.parentNode?.insertBefore(letterAvatar, avatar);
            }
            // Handle snoovatar containers
            else if (avatar.classList.contains('snoovatar')) {
                avatar.setAttribute(SilentReddit.DATA_ATTRS.ICON_REPLACED, 'true');
                avatar.setAttribute(SilentReddit.DATA_ATTRS.ORIGINAL_STYLE, avatar.style.cssText);
                avatar.style.setProperty('display', 'none', 'important');
                avatar.parentNode?.insertBefore(letterAvatar, avatar);
            }
        });
    });
},
```

### 实现说明

**方法功能**：
专门处理版主列表中的头像替换，解决头像和用户链接是兄弟节点的特殊DOM结构问题。

**工作流程**：
1. 使用 `MODERATOR_LIST_ITEM` 选择器查找所有 `faceplate-tracker[source="moderator_list"]` 元素
2. 从每个 tracker 向上查找包含它的 `<li>` 元素
3. 在该 `<li>` 内查找所有头像（`img` 和 `.snoovatar`）
4. 从 tracker 内的用户链接提取用户名
5. 为每个头像创建字母头像并插入到原头像前面
6. 隐藏原头像并标记为已替换

**支持的头像类型**：
- **普通img头像** - 如 `<img src="https://styles.redditmedia.com/...">`
- **Snoovatar头像** - SVG格式的自定义头像
- **默认头像** - 如 `<img src="https://www.redditstatic.com/avatars/defaults/...">`

**DOM结构特点**：
```html
<li>
  <span>
    <span rpl="" avatar="">
      <img src="..." alt="u/PopMechanic 头像">
    </span>
  </span>
  <faceplate-tracker source="moderator_list">
    <a href="/user/PopMechanic/">u/PopMechanic</a>
  </faceplate-tracker>
</li>
```
头像和 faceplate-tracker 是兄弟节点，需要通过共同的父级 `<li>` 关联。

---
*创建时间: 2025-10-19*
````